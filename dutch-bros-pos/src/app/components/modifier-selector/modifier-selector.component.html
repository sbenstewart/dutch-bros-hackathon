<header class="modal-header">
  <div class="header-text">
    <h2>{{ product.name }}</h2>
    <p>{{ product.description }}</p>
  </div>
  <button class="close-btn" (click)="close()">&times;</button>
</header>

<div class="modal-body">
  <div class="modal-image-container">
    <img [src]="getProductImage()" [alt]="product.name" class="modal-image" />
  </div>
  
  <!-- Loop through modifier groups -->
  <div *ngFor="let group of modifierChain.groups" class="modifier-group">
    <h3>
      {{ group.name }}
      <span *ngIf="group.required" class="required-star"> *</span>
    </h3>

    <!-- Grid for options -->
    <div class="options-grid" [class.grid-2]="group.options && group.options.length > 2">
      <button *ngFor="let option of group.options"
              class="modifier-option"
              [class.active]="isSelected(group.id, option.id)"
              (click)="selectOption(group, option)">
        <span>{{ option.name }}</span>
        <span *ngIf="option.price_adjustment > 0" class="mod-price">+${{ option.price_adjustment.toFixed(2) }}</span>
        <span *ngIf="option.price_adjustment < 0" class="mod-price">-${{ (option.price_adjustment * -1).toFixed(2) }}</span>
      </button>
    </div>

    <!-- Handle Range/Sweetness -->
    <div *ngIf="group.type === 'range'" class="range-slider">
      <input
        type="range"
        [min]="group.min"
        [max]="group.max"
        [step]="group.step"
        [value]="selectedModifiers()[group.id] || group.default"
        (input)="selectOption(group, { id: ($any($event.target).value), name: '', price_adjustment: 0 })"
      />
      <p>Current: **{{ selectedModifiers()[group.id] || group.default }} {{ group.label }}**</p>
    </div>
  </div>

  <!-- Quantity Stepper -->
  <div class="modifier-group">
    <h3>Quantity</h3>
    <div class="quantity-stepper">
      <button (click)="decQty()" [disabled]="quantity() === 1">-</button>
      <span>{{ quantity() }}</span>
      <button (click)="incQty()">+</button>
    </div>
  </div>

  <!-- Special Instructions -->
  <div class="modifier-group">
    <h3>Special Instructions</h3>
    <textarea placeholder="Any special requests or allergens..."></textarea>
  </div>

  <!-- Customizations Summary -->
  <div class="modifier-group summary-group">
    <h3>Customizations:</h3>
    <ul class="summary-list">
      <li *ngFor="let mod of customizationSummary()">
        <span>+ {{ mod.name }}</span>
        <span>{{ mod.price > 0 ? '+$' + mod.price.toFixed(2) : (mod.price < 0 ? '-$' + (mod.price * -1).toFixed(2) : ' ') }}</span>
      </li>
    </ul>
  </div>

</div>

<footer class="modal-footer">
  <div class="total-section">
    <span class="total-label">Total</span>
    <span class="total-price">${{ totalPrice().toFixed(2) }}</span>
    <span class="total-each" *ngIf="quantity() > 1">
      ${{ singleItemPrice().toFixed(2) }} each &times; {{ quantity() }}
    </span>
  </div>
  <div class="action-buttons">
    <button class="add-to-cart-btn" (click)="addToCart()">
      Add New
    </button>
    <button *ngIf="editingCartItemId" class="add-to-cart-btn" (click)="modifyExisting()">
      Modify
    </button>
  </div>
</footer>
